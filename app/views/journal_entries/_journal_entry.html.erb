<% raise "Journal Entry is nil:" if journal_entry.nil? %>

<div class="journal-entry">

  <!-- Title (clickable only by the owner) -->
  <h4>
    <% if journal_entry.user == Current.user %>
      <%= link_to journal_entry.title,
          trip_journal_entry_path(journal_entry.trip, journal_entry),
          class: "entry-link" %>
    <% else %>
      <%= journal_entry.title %>
    <% end %>
  </h4>

  <!-- Content -->
  <p><%= journal_entry.content %></p>

  <!-- Images -->
  <% if journal_entry.media.attached? %>
    <div class="journal-entry-images">
      <% journal_entry.media.each do |file| %>
        <%= image_tag file, class: "img-fluid rounded mb-2" %>
      <% end %>
    </div>
  <% end %>

  <!-- Dates -->
  <p class="journal-entry-date">
    <em>Went at <%= journal_entry.date.strftime("%B %d, %Y") %></em>
  </p>

  <p class="text-muted small">
    Posted by <%= journal_entry.user.name %> on
    <%= journal_entry.created_at.strftime("%B %d, %Y") %>
  </p>

  <!-- REACTIONS -->
  <div class="reaction-bar">

    <% user_reaction = journal_entry.reactions.find_by(user: Current.user) %>

    <div class="reaction-options">
      <% Reaction::REACTION_TYPES.each do |emoji| %>

        <% method_type = user_reaction.present? ? :patch : :post %>

        <%= button_to trip_journal_entry_react_path(journal_entry.trip, journal_entry),
            method: method_type,
            params: { reaction_type: emoji },
            class: "reaction-emoji-btn #{'active-reaction' if user_reaction&.reaction_type == emoji}" do %>
          <%= emoji %>
        <% end %>

      <% end %>
    </div>

    <% if user_reaction.present? %>
      <%= button_to trip_journal_entry_unreact_path(journal_entry.trip, journal_entry),
          method: :delete,
          class: "reaction-remove-btn" do %>
        âœ•
      <% end %>
    <% end %>

    <div class="reaction-count">
      <% total = journal_entry.reactions.count %>

      <% if user_reaction.present? %>
        <% others = total - 1 %>
        <% if others > 0 %>
          You + <%= others %>
        <% else %>
          You
        <% end %>
      <% else %>
        <%= total %>
      <% end %>
    </div>

  </div>

  <hr>
</div>
