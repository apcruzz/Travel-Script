<%= bootstrap_form_for(@trip.present? ? [ @trip, @journal_entry ] : @journal_entry) do |f| %>

  <% if defined?(@trips) && @trips.present? %>
    <div class="mb-3">
      <%= f.label :trip_id, "Select Trip" %>
      <%= f.collection_select :trip_id,
            @trips,
            :id,
            :title,
            { prompt: "Choose a trip" },
            { class: "form-select" } %>
    </div>
  <% elsif @trip.present? %>
    <%= f.hidden_field :trip_id, value: @trip.id %>
  <% end %>

  <%= f.text_field :title %>
  <%= f.text_area :content %>
  <%= f.date_field :date %>

  <%# Existing images (only when editing) %>
  <% if @journal_entry.media.attached? %>
    <div class="mb-3">
      <label>Current Images:</label>
      <div class="row g-3">
        <% @journal_entry.media.each do |file| %>
          <div class="col-md-4 text-center">
            <%= image_tag file, class: "img-thumbnail mb-2", width: 200 %>
            <div class="form-check">
              <%= check_box_tag "remove_media_ids[]", file.id, false,
                    id: "remove_media_#{file.id}",
                    class: "form-check-input" %>
              <%= label_tag "remove_media_#{file.id}", "Remove?" %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>

  <div class="mb-3">
    <%= f.label :media, "Add Images" %>
    <%= f.file_field :media, multiple: true, class: "form-control" %>
  </div>

  <%= f.submit(@journal_entry.persisted? ? "Update Journal Entry" : "Create Journal Entry",
               class: "btn btn-primary") %>

<% end %>
